# Flink 笔记

<https://flink.apache.org/>

Flink（德语：快速、灵巧）起源于Stratosphere项目，由柏林理工大学教授2010\~2014年领衔开发，并于2014年捐献给Apache基金会。

特性：

+ 批流统一 —— 同一套代码/SQL可以跑流处理也可以跑批处理
+ 性能卓越 —— 高吞吐、低时延
+ 规模计算 —— 本身是分布式框架，支持水平扩展架构、支持超大状态与增量检查点(changelog)机制 （支持：万亿事件/天、TB大小的状态、数千CPU上运行）
+ 生态兼容 —— 支持与Yarn集成、支持与Kubernetes集成、支持单机模型运行
+ 高容错 —— 故障自动重试、一致性检查点、保证故障场景下精确一次的状态一致性

场景：

+ 电商和市场营销。如：实时数据报表、广告投放、实时推荐
+ 物联网（IOT）。如：传感器实时数据采集和显示、实时报警、交通运输业
+ 物流配送和服务业。如：订单状态实时更新、通知信息推送
+ 银行和金融业。如：实时结算和通知推送、实时监测异常行为

## 特性

Apache Flink 是要给分布式处理引擎和开发框架，用于对“无界”和“有界”数据流进行有状态计算。

核心目标： **数据流上的有状态计算（Stateful Computations over Data Streams）**

处理流程：
`原始数据（实时数据：交易/日志/物联网/...，数据库，文件系统，键值存储）---->Flink（事件驱动=>处理流水线=>流&批数据分析）---->加工后的数据（应用服务，事件日志，数据库，文件系统，键值存储）`

### 流批统一

#### 有界 vs 无界

+ 无界数据流 —— 无明确区别不同数据的界限，比如水流每滴水看着都是一样的。针对这种数据一般需要“流处理”。
+ 有界数据流 —— 有明确区别不同数据的界限，比如信件两封信件是可以被区分的。针对这种数据一般需要“批处理”。

#### 有状态流处理

记录计算的状态。当新数据到来，根据当前处理状态决定新数据如何处理。
这可以实现一些统计功能，如的统计一段时间内相同类型事件数量。

### 精确性

#### 事件时间 vs 处理时间

即流水线处理事件时，是按事件初始到来时间计算，还是按流水线节点开始处理的时间开始计算。

+ 事件时间（event time） —— 对于乱序事件流，事件时间语义仍然能提供一致且准确的结果。
+ 处理时间（processing time）

#### 精确一次（exactly once）

状态一致性保证

### 存储系统集成

Kafka
Hive
JDBC
HDFS
Redis

### 高可用

本身高可用的设置，加上与K8s、YARN和Mesos的紧密集成，加上从故障中快速恢复和动态扩展任务的能力，Flink能做到极少的停机时间7x24全天候运行。

## 分层API

+ SQL —— 最高层语言
+ Table API —— 以二维表结构为中心的声明式领域专用语言，类似关系数据库中的表，操作如`select`、`project`、`join`、`group-by`、`aggregate`等
+ DataStream/DataSet API —— 核心APIs（DataStream，数据流，流处理；DataSet，数据集，批处理），提供了通用的模块，比如转换（transformations：map、flatmap等）、连接（joins）、聚合（aggregations）、窗口（windows）等等。
+ 有状态流处理 —— 底层APIs（处理函数process）

## 部署、架构

## 核心功能

基本API(Source/Sink)
时间语义
窗口

处理函数
状态编程
容错机制

SQL相关

+ sql-client
+ 查询语法
+ Connector
+ Catalog
+ Module

## 选型

### Flink vs SparkStreaming

Spark以批处理为根本。

Flink以流处理为根本。

todo <https://www.bilibili.com/video/BV1eg4y1V7AN>

---
title: OpenSCAP åŸºæœ¬ä½¿ç”¨
date: 2024-04-13
tag:
  - scap
  - openscap
---

[OpenSCAP](https://www.open-scap.org/) æ˜¯ä¸€ä¸ªéµå¾ª SCAP æ ‡å‡†çš„å¼€æºå·¥å…·ï¼Œç›®çš„æ˜¯æ ¹æ®å®‰å…¨ç­–ç•¥å’Œé…ç½®æ–‡ä»¶è¯„ä¼°æœ¬åœ°ç³»ç»Ÿçš„æ¼æ´å’Œæ ‡å‡†é…ç½®ã€‚
OpenSCAP æ”¯æŒåŸºçº¿æ ¸æŸ¥ï¼ˆæ¼æ´æ‰«æ/é…ç½®è¯„ä¼°/åˆè§„æ€§æ ¸æŸ¥ï¼‰ï¼ŒæŠ¥å‘Šå’Œè‡ªåŠ¨ä¿®å¤ï¼Œç›®å‰ä¸»è¦æœ‰ Redhat è¿›è¡Œç»´æŠ¤ã€‚

::: tip

ä¸ºä»€ä¹ˆä½¿ç”¨ OpenSCAP åšåŸºçº¿æ ¸æŸ¥ï¼Ÿ

- å®Œæˆåº¦é«˜
- æ”¯æŒ SCAP ç»„ä»¶ï¼šæ£€æŸ¥é¡¹ï¼ˆCCEï¼‰ï¼Œæ£€æŸ¥æ–¹å¼ï¼ˆOVALï¼‰å’ŒåŸºçº¿æ ‡å‡†åŒ–ï¼ˆPCI,STIGï¼‰ç­‰ NIST å’Œ MITRE ç»´æŠ¤çš„ç¾å›½æ”¿åºœæˆ–è€…è¡Œä¸šæ ‡å‡†
- æ”¯æŒå¤šç§è¿è¡Œæ–¹å¼(bash/ansible/openscap)
- æ”¯æŒé—®é¢˜ä¿®å¤
- å®¹æ˜“æ‰©å±•ï¼ŒäºŒæ¬¡å¼€å‘åˆ¶ä½œè‡ªå®šä¹‰çš„åŸºçº¿å¯ç”¨çš„é«˜è´¨é‡èµ„æºè¾ƒå¤š

:::

<!-- more -->

::: info

å‚è€ƒï¼š

- STIG Scanning with OpenSCAP â€”â€” <https://medium.com/defense-unicorns/stig-scanning-with-openscap-675c7292d7cb>
- Running a Scan with OpenSCAPïƒ â€”â€” <https://complianceascode.readthedocs.io/en/latest/manual/user/20_scanning.html>
- OpenSCAP User Manual â€”â€” <https://static.open-scap.org/openscap-1.3/oscap_user_manual.html>

å¾…æ•´ç†ï¼š

- OpenSCAP ç³»ç»Ÿæ¼æ´æ‰«æåŠåŠ å›ºè§£å†³æ–¹æ¡ˆ - <https://www.liuchunhua.me/post/security/01openscap/openscap/#documentTop>
- ~~todo https://blog.csdn.net/m0_46097570/article/details/119876480~~

:::

## åŸºæœ¬åŠŸèƒ½

OpenSCAP çš„ä½¿ç”¨å›´ç»•è§£æåŸºçº¿é…ç½®æ–‡ä»¶å’Œæ‰§è¡ŒåŸºçº¿è¯„ä¼°å±•å¼€ï¼Œå…¶ä»–åŠŸèƒ½å‡ä¸ºæ­¤æœåŠ¡ã€‚

### æ‰§è¡Œå·¥å…·å’ŒåŸºçº¿åº“

OpenSCAP ç”±å·¥å…·å’ŒåŸºçº¿åº“ï¼ˆbenchmarkï¼‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š

- å·¥å…· `oscap` æä¾›è§„åˆ™è§£æå’Œæ‰§è¡ŒåŠŸèƒ½

  ::: tabs#usage

  @tab Ubuntu

  ```bash
  sudo apt install libopenscap8
  oscap -V
  ```

  @tab Centos

  ```bash
  yum install openscap-utils
  yum install openscap-scanner
  ```

  :::

- åŸºçº¿åº“æä¾›æœºå™¨å¯è¯»æ ¼å¼ ï¼ˆXCCDFï¼‰æ–‡ä»¶ã€‚å…¶å†…å®¹ä¸€èˆ¬ç”± STIGï¼ˆå’Œå…¶ä»–å®‰å…¨å‡†åˆ™ï¼‰è½¬æ¢å¾—æ¥ã€‚OpenSCAP å¯ä»¥ä½¿ç”¨è¯¥æ ¼å¼æ‰«æç³»ç»Ÿçš„æ¼æ´å’Œåˆè§„æ€§ã€‚
  åŸºçº¿åº“å¦‚ï¼š

  - [SSGï¼ˆSCAP Security Guideï¼ŒSCAP å®‰å…¨æŒ‡å¯¼ï¼‰](https://www.open-scap.org/security-policies/scap-security-guide/#install)

    ::: tabs#usage

    @tab Ubuntu

    ```bash
    # ä¸‹è½½
    sudo apt install ssg-debderived
    # You can install SCAP Security Guide on Ubuntu 18.04 and newer using apt:
    apt install ssg-base ssg-debderived ssg-debian ssg-nondebian ssg-applications
    ```

    å‚è€ƒï¼š

    - <https://ubuntu.com/security/disa-stig>

    @tab Centos

    ```bash
    $ yum install scap-security-guide
    ```

    :::

  - å¼€æºé¡¹ç›® [ComplianceAsCode](https://github.com/ComplianceAsCode/content)

    ```bash
    sudo wget https://github.com/ComplianceAsCode/content/releases/download/v0.1.69/scap-security-guide-0.1.69.zip
    ```

::: tip

OpenSCAP å·¥å…·å’ŒåŸºçº¿åº“ä¸¤è€…æ²¡æœ‰ç´§å¯†çš„è€¦åˆå…³ç³»ï¼Œæ¯”å¦‚ä½¿ç”¨ <http://vuls.io> ä¹Ÿå¯ä»¥è¿è¡Œéƒ¨åˆ†åŸºçº¿åº“ï¼ŒåŸºçº¿åº“éƒ¨åˆ†åŠŸèƒ½ä¹Ÿæ”¯æŒä½¿ç”¨ ansible å’Œ bash æ¥æ‰§è¡Œã€‚

:::

### æ‰«æåŸºçº¿å’Œæ‰«æç»“æœ

æœ‰äº† oscap å·¥å…·å’ŒåŸºçº¿åº“åï¼Œå¯é€šè¿‡ `oscap info ssg-ubuntu2004-ds-1.2.xml` æŸ¥çœ‹å†…å®¹ï¼š

```bash
$ oscap info ssg-ubuntu2204-ds-1.2.xml
Document type: Source Data Stream
Imported: 2023-08-02T09:12:43

Stream: scap_org.open-scap_datastream_from_xccdf_ssg-ubuntu2204-xccdf.xml
Generated: (null)
Version: 1.2
Checklists:
        Ref-Id: scap_org.open-scap_cref_ssg-ubuntu2204-xccdf.xml
                Status: draft
                Generated: 2023-08-02
                Resolved: true
                Profiles: # ğŸ’¡é…ç½®æ–‡ä»¶
                        Title: CIS Ubuntu 22.04 Level 1 Server Benchmark
                                Id: xccdf_org.ssgproject.content_profile_cis_level1_server
                        Title: CIS Ubuntu 22.04 Level 1 Workstation Benchmark
                                Id: xccdf_org.ssgproject.content_profile_cis_level1_workstation
                        Title: CIS Ubuntu 22.04 Level 2 Server Benchmark
                                Id: xccdf_org.ssgproject.content_profile_cis_level2_server
                        Title: CIS Ubuntu 22.04 Level 2 Workstation Benchmark
                                Id: xccdf_org.ssgproject.content_profile_cis_level2_workstation
                        Title: Standard System Security Profile for Ubuntu 22.04
                                Id: xccdf_org.ssgproject.content_profile_standard
                Referenced check files:
                        ssg-ubuntu2204-oval.xml
                                system: http://oval.mitre.org/XMLSchema/oval-definitions-5
                        ssg-ubuntu2204-ocil.xml
                                system: http://scap.nist.gov/schema/ocil/2
Checks:
        Ref-Id: scap_org.open-scap_cref_ssg-ubuntu2204-oval.xml
        Ref-Id: scap_org.open-scap_cref_ssg-ubuntu2204-ocil.xml
        Ref-Id: scap_org.open-scap_cref_ssg-ubuntu2204-cpe-oval.xml
Dictionaries:
        Ref-Id: scap_org.open-scap_cref_ssg-ubuntu2204-cpe-dictionary.xml
```

é’ˆå¯¹ ssg æ–‡ä»¶çš„ profile xccdf é…ç½®ï¼Œä½¿ç”¨ `oscap xccdf eval` è¿›è¡Œè¯„ä¼°ï¼š

```bash
# oscap [options] module operation [operation-options-and-arguments]
oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_standard --report report.html ssg-ubuntu2204-ds-1.2.xml
# --results results.xml å¯ç”¨äºé—®é¢˜ä¿®å¤
oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_standard --report report.html --results results.xml ssg-ubuntu2204-ds-1.2.xml
```

### é’ˆå¯¹æ‰«æç»“æœè¿›è¡Œä¿®å¤

todo [RMFï¼ˆRisk Management Frameworkï¼Œé£é™©ç®¡ç†æ¡†æ¶ï¼‰](https://csrc.nist.gov/pubs/sp/800/37/r2/final) æ˜¯ NIST çš„å‡ºç‰ˆç‰©ï¼Œä¸ºå¦‚ä½•æœ‰æ•ˆç®¡ç†ä¿¡æ¯å®‰å…¨å’Œéšç§é£é™©æä¾›äº†æŒ‡å¯¼ï¼Œä¸ºç»„ç»‡æä¾›äº†ä¸€ç§ç³»ç»Ÿçš„æ–¹æ³•æ¥è¯†åˆ«ã€è¯„ä¼°ã€å“åº”å’Œç›‘æ§ä¸å…¶ä¿¡æ¯ç³»ç»Ÿå’Œèµ„äº§ç›¸å…³çš„é£é™©ã€‚

`--results results.xml` ç”Ÿæˆå¦‚ä¸‹ç»“æœï¼š

```xml
<!-- å¯¹åº”çš„ XCCDF æ£€æŸ¥æ¸…å•æ£€æŸ¥é¡¹ -->
<rule-result idref="ensure_gpgcheck_globally_activated" time="2023-02-16T10:03:43" severity="high" weight="1.000000">
  <!-- é€šè¿‡/å¤±è´¥/ä¸é€‚ç”¨ -->
  <result>pass</result>
  <!-- å¯¹åº”çš„æ£€æŸ¥é¡¹é—®é¢˜ -->
  <ident system="http://cce.mitre.org">CCE-83457-2</ident>
  <!-- å¯¹åº”çš„ OVAL æ£€æŸ¥é¡¹æ£€æŸ¥å®ç°ï¼ˆæ£€æŸ¥æ–¹å¼ï¼‰ -->
  <check system="http://oval.mitre.org/XMLSchema/oval-definitions-5">
    <check-content-ref name="oval:ssg:def:413" href="ssg-rhel9-oval.xml"/>
  </check>
</rule-result>
......
<rule-result idref="package_aide_installed" time="2023-02-16T10:03:43" severity="medium" weight="1.000000">
  <result>pass</result>
  <ident system="http://cce.mitre.org">CCE-90843-4</ident>
  <!-- ä¿®æ­£çš„ bash è„šæœ¬ -->
  <fix xmlns:xhtml="http://www.w3.org/1999/xhtml" system="urn:xccdf:fix:script:sh">
    yum -y install aide
  </fix>
  <check system="http://oval.mitre.org/XMLSchema/oval-definitions-5">
    <check-content-ref name="oval:ssg:def:245" href="ssg-rhel9-oval.xml"/>
  </check>
</rule-result>
```

ç”Ÿæˆä¿®å¤è„šæœ¬

```bash
# ç”Ÿæˆ bash è„šæœ¬
oscap xccdf generate fix --profile xccdf_org.ssgproject.content_profile_standard results.xml
# oscap xccdf generate fix --profile xccdf_org.ssgproject.content_profile_standard -o fix.sh results.xml

# ç”Ÿæˆ ansible è„šæœ¬
oscap xccdf generate fix --profile xccdf_org.ssgproject.content_profile_standard --fix-type ansible results.xml
```

## ç»„ä»¶

```bash
$ oscap -h
oscap

OpenSCAP command-line tool

Usage: oscap [options] module operation [operation-options-and-arguments]

oscap options:
   -h --help                     - show this help
   -q --quiet                    - quiet mode
   -V --version                  - print info about supported SCAP versions

Commands:
    ds - DataStream utilities
    oval - Open Vulnerability and Assessment Language
    xccdf - eXtensible Configuration Checklist Description Format
    cvss - Common Vulnerability Scoring System
    cpe - Common Platform Enumeration
    cve - Common Vulnerabilities and Exposures
    cvrf - Common Vulnerability Reporting Framework
    info - info module
```

### OVAL ç»„ä»¶

OVAL ç³»ç»Ÿä¿¡æ¯æ”¶é›† â€”â€” è§£æ OVAL å®šä¹‰ï¼Œæ”¶é›†ç³»ç»Ÿä¿¡æ¯ï¼Œç”Ÿæˆ OVAL è¯„ä¼°ç»“æœ

```bash
# è¯„ä¼° scap-oval.xml ä¸­çš„æ‰€æœ‰å®šä¹‰ï¼Œç”Ÿæˆ oval-results.xml è¯„ä¼°ç»“æœ
oscap oval eval --results oval-results.xml scap-oval.xml
# è¯„ä¼°ç‰¹å®š oval:rhel:def:1000 å®šä¹‰
oscap oval eval --id oval:rhel:def:1000 --results oval-results.xml scap-oval.xml
# è¯„ä¼° OVAL ç»„ä»¶çš„æ‰€æœ‰å®šä¹‰ï¼Œè¿™äº›å®šä¹‰æ˜¯ SCAP æ•°æ®æµé›†åˆä¸­ç‰¹å®šæ•°æ®æµçš„ä¸€éƒ¨åˆ†
oscap oval eval --datastream-id ds.xml --oval-id xccdf.xml --results oval-results.xml scap-ds.xml
```

### XCCDF ç»„ä»¶

XCCDF åŸºå‡†è¯„ä¼° â€”â€” åœ¨è¯„ä¼° XCCDF åŸºå‡†æ—¶ï¼Œoscap ä¼šå¤„ç† XCCDF æ–‡ä»¶ã€OVAL æ–‡ä»¶ã€ CPE è¯å…¸ã€‚æ‰§è¡Œè¿™äº›ç³»ç»Ÿåˆ†æï¼Œå¹¶åœ¨æ­¤åˆ†æçš„åŸºç¡€ä¸Šäº§ç”Ÿ XCCDF ç»“æœ

```bash
# è¯„ä¼° XCCDF æ–‡ä»¶ä¸­çš„ç‰¹å®šé…ç½®æ–‡ä»¶
# | scap-xccdf.xml     æ˜¯ XCCDF æ–‡æ¡£
# | Desktop            æ˜¯ä» XCCDF æ–‡æ¡£ä¸­é€‰æ‹©çš„é…ç½®æ–‡ä»¶
# | xccdf-results.xml  æ˜¯å­˜å‚¨æ‰«æç»“æœçš„æ–‡ä»¶
# | cpe-dictionary.xml æ˜¯ CPE è¯å…¸
oscap xccdf eval --profile Desktop --results xccdf-results.xml --cpe cpe-dictionary.xml scap-xccdf.xml
# æŒ‡å®šè¦è¯„ä¼°çš„è§„åˆ™
# è¿™é‡Œçš„è§„åˆ™ â€œsures_gpgcheck_globally_activatedâ€ æ˜¯ â€œDesktopâ€ é…ç½®æ–‡ä»¶ä¸­å°†è¦è¯„ä¼°çš„å”¯ä¸€è§„åˆ™
oscap xccdf eval --profile Desktop --rule ensure_gpgcheck_globally_activated  --results xccdf-results.xml --cpe cpe-dictionary.xml scap-xccdf.xml
# è¯„ä¼°ä½œä¸º SCAP DataStream é›†åˆå†… DataStream ä¸€éƒ¨åˆ†çš„ç‰¹å®š XCCDF åŸºå‡†
# | scap-ds.xml       æ˜¯è¡¨ç¤º SCAP DataStream é›†åˆçš„æ–‡ä»¶
# | ds.xml            æ˜¯ç‰¹å®šçš„ DataStream
# | xccdf.xml         æ˜¯æŒ‡å‘æ‰€éœ€ XCCDF æ–‡æ¡£çš„ component-ref çš„ ID
# | xccdf-results.xml æ˜¯åŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶æ‰«æç»“æœ
oscap xccdf eval --datastream-id ds.xml --xccdf-id xccdf.xml --results xccdf-results.xml scap-ds.xml

# ç”Ÿæˆ arf æ ¼å¼çš„è¯„ä¼°ç»“æœ
oscap xccdf eval --benchmark-id Benchmark_id --results-arf arf-results.xml scap-ds.xml
# ç”Ÿæˆå¯å¯¼å…¥ DISA STIG Viewer çš„è¯„ä¼°ç»“æœ
oscap xccdf eval --profile stig-rhel7-disa --stig-viewer results-stig.xml ssg-rhel7-ds.xml
```

> STIG Viewing Tools
> https://public.cyber.mil/stigs/srg-stig-tools/

ä¾‹å­ï¼š

```bash
# åˆ—å‡ºå½“å‰å¯ç”¨çš„åŸºçº¿åº“
$ ll /usr/share/xml/scap/ssg/content/ | grep xccdf`
-rw-r--r-- 1 root root 5086947 Aug 23 2019 ssg-centos6-xccdf.xml
-rw-r--r-- 1 root root 8156658 Aug 23 2019 ssg-centos7-xccdf.xml # å½“å‰ç³»ç»Ÿä¸º Centos 7ï¼Œæ‰€ä»¥é€‰æ‹© ssg-centos7-xccdf.xml
-rw-r--r-- 1 root root 145235 Aug 23 2019 ssg-firefox-xccdf.xml
-rw-r--r-- 1 root root 113243 Aug 23 2019 ssg-jre-xccdf.xml # å¦‚æœç³»ç»Ÿå®‰è£…äº† Java ç¯å¢ƒï¼Œä¹‹åä¹Ÿå¯ä»¥ä½¿ç”¨ ssg-jre-xccdf.xml å¯¹ Java è¿›è¡Œæ ¸æŸ¥
-rw-r--r-- 1 root root 5410079 Aug 23 2019 ssg-rhel6-xccdf.xml
-rw-r--r-- 1 root root 8671063 Aug 23 2019 ssg-rhel7-xccdf

# æŸ¥çœ‹åŸºçº¿åº“å†…å®¹
# é‡Œé¢æœ‰ 5 ä¸ªåŸºçº¿ï¼ˆProfilesï¼‰ï¼Œä¸åŒçš„åŸºçº¿æ£€æŸ¥é¡¹ç›®æ•°é‡å’Œç»“æœåˆ¤æ–­æ ‡å‡†ä¸åŒ
$ oscap info /usr/share/scap-security-guide/ssg-ubuntu1604-xccdf.xml
Document type: XCCDF Checklist
Checklist version: 1.1
Imported: 2017-08-11T17:18:08
Status: draft
Generated: 2017-08-11
Resolved: true
Profiles:
Title: Common Profile for General-Purpose Ubuntu Systems
Id: common # åŸºçº¿ 1ï¼šå¦‚æœæ˜¯ Centos7ï¼Œå¯ä»¥é€‰æ‹© standard
Title: Profile for ANSSI DAT-NT28 Minimal Level
Id: anssi_np_nt28_minimal # åŸºçº¿ 2
Title: Profile for ANSSI DAT-NT28 Average (Intermediate) Level
Id: anssi_np_nt28_average # åŸºçº¿ 3
Title: Profile for ANSSI DAT-NT28 Restrictive Level
Id: anssi_np_nt28_restrictive # åŸºçº¿ 4
Title: Profile for ANSSI DAT-NT28 High (Enforced) Level
Id: anssi_np_nt28_high # åŸºçº¿ 5
Referenced check files:
ssg-ubuntu1604-oval.xml
system: http://oval.mitre.org/XMLSchema/oval-definitions-5
ssg-ubuntu1604-ocil.xml
system: http://scap.nist.gov/schema/ocil/2

# æ‰§è¡Œæ ¸æŸ¥ï¼Œç”ŸæˆæŠ¥å‘Š
# --profile æŒ‡å®šåŸºçº¿ Id
# --results-arf æŒ‡å®šç”Ÿæˆçš„ arf æŠ¥å‘Šæ–‡ä»¶
# --report æŒ‡å®šç”Ÿæˆçš„ html æŠ¥å‘Šæ–‡ä»¶å
oscap xccdf eval --profile standard --results-arf arf.xml --report report.html /usr/share/xml/scap/ssg/content/ssg-centos7-xccdf.xml
```

> **ARFï¼ˆAsset Reporting Formatï¼Œèµ„äº§æŠ¥å‘Šæ ¼å¼ï¼‰** æ–¹ä¾¿ç»“æœä¼ è¾“çš„ä¸€ç§æ ¼å¼ï¼Œä¹Ÿè¢«ç§°ä¸º RDï¼ˆResult DataStreamï¼Œç»“æœæ•°æ®æµï¼‰ã€‚

## æ„æˆ

OpenScap æ„æˆï¼š

- OpenSCAP Base â€”â€” å³ `oscap` å‘½ä»¤è¡Œå·¥å…·ï¼Œæœ¬åœ°æ‰«æï¼Œé€‚åˆåšä¸€æ¬¡æ€§çš„æœåŠ¡ã€‚
  ï¼ˆ1.2.3 å¼€å§‹æœ‰æ”¯æŒ ssh çš„è¿œç¨‹æ‰«æã€‚è¿œç¨‹æ‰«æéœ€è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šå·²ç»å®‰è£… OpenSCAP Baseï¼‰
- OpenSCAP Daemon â€”â€” å®ˆæŠ¤è¿›ç¨‹å·¥å…·ï¼ŒåŠŸèƒ½åŒ OpenSCAP Baseï¼Œé€‚åˆåšæŒç»­çš„åˆè§„æœåŠ¡
- SCAP Workbench â€”â€” å›¾å½¢ç•Œé¢ï¼ŒåŠŸèƒ½åŒ SCAP Baseï¼Œé€‚åˆå…¥é—¨ï¼Œå¯è§†åŒ–æ“ä½œ
- SCAP Timony â€”â€” ä¸­é—´ä»¶ï¼Œæ•°æ®å­˜å‚¨æœåŠ¡ï¼Œç”¨äºå­˜å‚¨åŸºç¡€ç»“æ„çš„ SCAP ç»“æœï¼Œç„¶åå…è®¸å¯¹å­˜å‚¨çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚ä¸€èˆ¬æ­é… OpenSCAP Daemon ä½¿ç”¨
